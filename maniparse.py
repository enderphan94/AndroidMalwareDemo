from xml.dom import minidom
from termcolor import colored
import optparse

parser = optparse.OptionParser()

parser.add_option('-f','--file',type="string",dest="maniFile",help="Manifest file")
(options,args) = parser.parse_args()

path = options.maniFile

if path is None:
	print "Please provide your manifest file" 
	exit()

fname = "pattern.txt"
arr_permis = []

with open(fname) as f:
	content = f.readlines()

#path = "/home/locpv/apps/QuantaGame_PrivateNet_Security/AndroidManifest.xml"
xmldoc = minidom.parse(path)

permises1 = xmldoc.getElementsByTagName('uses-permission')
permises2 = xmldoc.getElementsByTagName('android:uses-permission')

for permis1 in permises1:
	arr_permis.append(permis1.attributes['android:name'].value)
for permis2 in permises2:
	arr_permis.append(permis2.attributes['android:name'].value)

print colored("\nFrequent permissions extracted from malware Apps:",'red')
for permis in arr_permis:
	print permis

print colored("\nFrequent permissions extracted from malware Apps:",'red')
for permis in arr_permis:
	for x in content:
		if (x.strip() == permis):
			print colored("!!! ",'red') + permis 
