from xml.dom import minidom
from termcolor import colored
import optparse

parser = optparse.OptionParser()

parser.add_option('-f','--file',type="string",dest="maniFile",help="Manifest file",metavar="FILE")
(options,args) = parser.parse_args()

path = options.maniFile

if path is None:
	print "Please provide your manifest file" 
	exit()

maliFile = "mali_pattern.txt"
benignFile = "benign_pattern.txt"

arr_permis = []
m_permis = 0
b_permis = 0

with open(maliFile) as f:
	m_content = f.readlines()

with open(benignFile) as f:
	b_content = f.readlines()

#path = "/home/locpv/apps/QuantaGame_PrivateNet_Security/AndroidManifest.xml"
xmldoc = minidom.parse(path)

permises1 = xmldoc.getElementsByTagName('uses-permission')
permises2 = xmldoc.getElementsByTagName('android:uses-permission')

for permis1 in permises1:
	arr_permis.append(permis1.attributes['android:name'].value)
for permis2 in permises2:
	arr_permis.append(permis2.attributes['android:name'].value)

print colored("\nFrequent permissions extracted from malware Apps:",'red')
for permis in arr_permis:
	print permis

print colored("\nFrequent permissions extracted from malware Apps:",'red')
for permis in arr_permis:
	for m in m_content:
		if (m.strip() == permis):
			print colored("!!! ",'red') + permis 
			m_permis += 1 

print colored("\nFrequent permissions extracted from benign Apps:",'blue')
for permis in arr_permis:
        for b in b_content:
                if (b.strip() == permis):
                        print colored("+++ ",'blue') + permis
			b_permis += 1

p = float(m_permis - b_permis)/len(arr_permis)

print colored("\nMalignancy score is: ",'red')
print p

